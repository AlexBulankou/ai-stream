<!DOCTYPE html>
<html>
<head>
    <title>AI Stream</title>
</head>
<body>
    <div id="root"></div>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.12.0.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.2.0.min.js"></script>
    <script src="aistream/hubs"></script>
    <script src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['corechart']}]}"></script>

    <script type="text/javascript">
        var getUrlParameterByName = function (name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        };

        var getRandomInt = function (min, max) {
            return Math.floor(Math.random() * (max - min)) + min;
        };

        var resourceHostUrl = "//ai.azureedge.net";
        if (getUrlParameterByName("local"))
        {
            resourceHostUrl = "http://localhost/aistreamweb/content";
        }

        $('head').append('<link rel="stylesheet" href="'+resourceHostUrl+'/css/aistream.css" type="text/css" />');
        $.getScript(resourceHostUrl+'/js/aistream.js').done(function () {

            if (getUrlParameterByName("test")) {
                window.aistream.confirmConnected();
                var addTestItems = function () {
                    var testItems = [
                "[{\"m\":" + "0" + ",\"id\":\"TRACE-635973277347079340\",\"d\":\"{\\\"name\\\":\\\"Microsoft.ApplicationInsights.b1eca647948a4740b0c51dd4f2902950.Message\\\",\\\"time\\\":\\\"2016-04-27T11:22:14.7079340Z\\\",\\\"iKey\\\":\\\"b1eca647-948a-4740-b0c5-1dd4f2902950\\\",\\\"tags\\\":{\\\"ai.internal.sdkVersion\\\":\\\"2.0.0.30671\\\",\\\"ai.device.roleInstance\\\":\\\"albulank-lptp2\\\",\\\"ai.operation.name\\\":\\\"GET Home\/Index\\\",\\\"ai.operation.parentId\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.operation.id\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.user.id\\\":\\\"647086C6-15B2-48C0-9FFC-9FA901CA33A6\\\",\\\"ai.session.id\\\":\\\"af4oi\\\"},\\\"data\\\":{\\\"baseType\\\":\\\"MessageData\\\",\\\"baseData\\\":{\\\"ver\\\":2,\\\"message\\\":\\\"Trace1\\\"}}}\",\"s\":true,\"ta\":\"2016-04-27T11:22:14.7087868+00:00\",\"ts\":\"2016-04-27T11:22:14.7087868+00:00\"}]",
                    "[{\"m\":" + "0" + ",\"id\":\"EVENT-TestEvent1-635973277347088435\",\"d\":\"{\\\"name\\\":\\\"Microsoft.ApplicationInsights.b1eca647948a4740b0c51dd4f2902950.Event\\\",\\\"time\\\":\\\"2016-04-27T11:22:14.7088435Z\\\",\\\"iKey\\\":\\\"b1eca647-948a-4740-b0c5-1dd4f2902950\\\",\\\"tags\\\":{\\\"ai.internal.sdkVersion\\\":\\\"2.0.0.30671\\\",\\\"ai.device.roleInstance\\\":\\\"albulank-lptp2\\\",\\\"ai.operation.name\\\":\\\"GET Home\/Index\\\",\\\"ai.operation.parentId\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.operation.id\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.user.id\\\":\\\"647086C6-15B2-48C0-9FFC-9FA901CA33A6\\\",\\\"ai.session.id\\\":\\\"af4oi\\\"},\\\"data\\\":{\\\"baseType\\\":\\\"EventData\\\",\\\"baseData\\\":{\\\"ver\\\":2,\\\"name\\\":\\\"TestEvent1\\\",\\\"measurements\\\":{\\\"metric1\\\":0.0116619952077335},\\\"properties\\\":{\\\"prop1\\\":\\\"val1\\\"}}}}\",\"s\":true,\"ta\":\"" + new Date().toISOString() + "\",\"ts\":\"2016-04-27T11:22:14.7097869+00:00\"}]",
                "[{\"m\":" + "0" + ",\"id\":\"EVENT-TestEvent1-635973277347096253\",\"d\":\"{\\\"name\\\":\\\"Microsoft.ApplicationInsights.b1eca647948a4740b0c51dd4f2902950.Event\\\",\\\"time\\\":\\\"2016-04-27T11:22:14.7096253Z\\\",\\\"iKey\\\":\\\"b1eca647-948a-4740-b0c5-1dd4f2902950\\\",\\\"tags\\\":{\\\"ai.internal.sdkVersion\\\":\\\"2.0.0.30671\\\",\\\"ai.device.roleInstance\\\":\\\"albulank-lptp2\\\",\\\"ai.operation.name\\\":\\\"GET Home\/Index\\\",\\\"ai.operation.parentId\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.operation.id\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.user.id\\\":\\\"647086C6-15B2-48C0-9FFC-9FA901CA33A6\\\",\\\"ai.session.id\\\":\\\"af4oi\\\"},\\\"data\\\":{\\\"baseType\\\":\\\"EventData\\\",\\\"baseData\\\":{\\\"ver\\\":2,\\\"name\\\":\\\"TestEvent1\\\",\\\"measurements\\\":{\\\"metric1\\\":0.64591053856812},\\\"properties\\\":{\\\"prop1\\\":\\\"val2\\\"}}}}\",\"s\":true,\"ta\":\"" + new Date().toISOString() + "\",\"ts\":\"2016-04-27T11:22:14.710288+00:00\"}]",
                "[{\"m\":" + "0" + ",\"id\":\"EXCEPTION-635973277347116334\",\"d\":\"{\\\"name\\\":\\\"Microsoft.ApplicationInsights.b1eca647948a4740b0c51dd4f2902950.Exception\\\",\\\"time\\\":\\\"2016-04-27T11:22:14.7116334Z\\\",\\\"iKey\\\":\\\"b1eca647-948a-4740-b0c5-1dd4f2902950\\\",\\\"tags\\\":{\\\"ai.internal.sdkVersion\\\":\\\"2.0.0.30671\\\",\\\"ai.device.roleInstance\\\":\\\"albulank-lptp2\\\",\\\"ai.operation.name\\\":\\\"GET Home\/Index\\\",\\\"ai.operation.parentId\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.operation.id\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.user.id\\\":\\\"647086C6-15B2-48C0-9FFC-9FA901CA33A6\\\",\\\"ai.session.id\\\":\\\"af4oi\\\"},\\\"data\\\":{\\\"baseType\\\":\\\"ExceptionData\\\",\\\"baseData\\\":{\\\"ver\\\":2,\\\"handledAt\\\":\\\"UserCode\\\",\\\"exceptions\\\":[{\\\"id\\\":54804024,\\\"typeName\\\":\\\"System.InvalidOperationException\\\",\\\"message\\\":\\\"Failure\\\",\\\"hasFullStack\\\":true}]}}}\",\"s\":false,\"ta\":\"" + new Date().toISOString() + "\",\"ts\":\"2016-04-27T11:22:14.7122894+00:00\"}]",
                "[{\"m\":" + getRandomInt(0, 100) + ",\"id\":\"DEPENDENCY-nmD5WMuqqSM=-635973277345137897\",\"d\":\"{\\\"name\\\":\\\"Microsoft.ApplicationInsights.b1eca647948a4740b0c51dd4f2902950.RemoteDependency\\\",\\\"time\\\":\\\"2016-04-27T11:22:14.5137897Z\\\",\\\"iKey\\\":\\\"b1eca647-948a-4740-b0c5-1dd4f2902950\\\",\\\"tags\\\":{\\\"ai.internal.sdkVersion\\\":\\\"2.0.0.30671\\\",\\\"ai.device.roleInstance\\\":\\\"albulank-lptp2\\\",\\\"ai.operation.name\\\":\\\"GET Home\/Index\\\",\\\"ai.operation.parentId\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.operation.id\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.user.id\\\":\\\"647086C6-15B2-48C0-9FFC-9FA901CA33A6\\\",\\\"ai.session.id\\\":\\\"af4oi\\\"},\\\"data\\\":{\\\"baseType\\\":\\\"RemoteDependencyData\\\",\\\"baseData\\\":{\\\"ver\\\":2,\\\"name\\\":\\\"TestDependency1\\\",\\\"id\\\":\\\"nmD5WMuqqSM=\\\",\\\"commandName\\\":\\\"TestCommand1\\\",\\\"value\\\":200,\\\"dependencyKind\\\":2,\\\"success\\\":true}}}\",\"s\":true,\"ta\":\"" + new Date().toISOString() + "\",\"ts\":\"2016-04-27T11:22:14.7142895+00:00\"}]",
                "[{\"m\":" + "0" + ",\"id\":\"METRIC-RL-635973277347980970\",\"d\":\"{\\\"name\\\":\\\"Microsoft.ApplicationInsights.b1eca647948a4740b0c51dd4f2902950.Metric\\\",\\\"time\\\":\\\"2016-04-27T11:22:14.7980970Z\\\",\\\"iKey\\\":\\\"b1eca647-948a-4740-b0c5-1dd4f2902950\\\",\\\"tags\\\":{\\\"ai.internal.sdkVersion\\\":\\\"2.0.0.30671\\\",\\\"ai.device.roleInstance\\\":\\\"albulank-lptp2\\\",\\\"ai.operation.name\\\":\\\"GET Home\/Index\\\",\\\"ai.operation.parentId\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.operation.id\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.user.id\\\":\\\"647086C6-15B2-48C0-9FFC-9FA901CA33A6\\\",\\\"ai.session.id\\\":\\\"af4oi\\\"},\\\"data\\\":{\\\"baseType\\\":\\\"MetricData\\\",\\\"baseData\\\":{\\\"ver\\\":2,\\\"metrics\\\":[{\\\"name\\\":\\\"RL\\\",\\\"kind\\\":\\\"Measurement\\\",\\\"value\\\":60}]}}}\",\"s\":true,\"ta\":\"" + new Date().toISOString() + "\",\"ts\":\"2016-04-27T11:22:14.79838+00:00\"}]",
                "[{\"m\":" + getRandomInt(100, 200) + ",\"id\":\"REQUEST-wshaO8dAeFo=-635973277347058915\",\"d\":\"{\\\"name\\\":\\\"Microsoft.ApplicationInsights.b1eca647948a4740b0c51dd4f2902950.Request\\\",\\\"time\\\":\\\"2016-04-27T11:22:14.7058915Z\\\",\\\"iKey\\\":\\\"b1eca647-948a-4740-b0c5-1dd4f2902950\\\",\\\"tags\\\":{\\\"ai.operation.id\\\":\\\"wshaO8dAeFo=\\\",\\\"ai.user.id\\\":\\\"647086C6-15B2-48C0-9FFC-9FA901CA33A6\\\",\\\"ai.session.id\\\":\\\"af4oi\\\",\\\"ai.internal.sdkVersion\\\":\\\"web: 2.0.0.25000\\\",\\\"ai.device.roleInstance\\\":\\\"albulank-lptp2\\\",\\\"ai.operation.name\\\":\\\"GET Home\/Index\\\"},\\\"data\\\":{\\\"baseType\\\":\\\"RequestData\\\",\\\"baseData\\\":{\\\"ver\\\":2,\\\"id\\\":\\\"wshaO8dAeFo=\\\",\\\"name\\\":\\\"GET Home\/Index\\\",\\\"startTime\\\":\\\"2016-04-27T04:22:14.7058915-07:00\\\",\\\"duration\\\":\\\"00:00:00.6796067\\\",\\\"success\\\":true,\\\"responseCode\\\":\\\"200\\\",\\\"url\\\":\\\"http:\/\/localhost\/testaistream\\\",\\\"httpMethod\\\":\\\"GET\\\"}}}\",\"s\":true,\"ta\":\"" + new Date().toISOString() + "\",\"ts\":\"2016-04-27T11:22:15.3861337+00:00\"}]"
                    ];

                    for (var i = 0; i < testItems.length; i++) {
                        window.aistream.addItems(testItems[i]);
                    }

                    //window.setTimeout(addTestItems, getRandomInt(10,2000));
                }

                addTestItems();
            }
        });

    </script>
</body>
</html>